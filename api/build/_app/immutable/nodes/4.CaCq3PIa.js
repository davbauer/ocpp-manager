import"../chunks/disclose-version.Bg9kRutz.js";import"../chunks/legacy.Bx86S8IA.js";import{p as ft,a as yt,t as G,f as a,j as i,g as r,i as Ct,k as o,o as It}from"../chunks/runtime.DvGnrOxf.js";import{d as _t,a as T,t as R,c as wt,s as w}from"../chunks/render.CP-ZJxph.js";import{i as xt}from"../chunks/if.BktC0TgM.js";import{e as Dt,i as $t}from"../chunks/each.DLolFtAN.js";import{i as At}from"../chunks/lifecycle.CZF0KIGC.js";import{s as zt,a as x}from"../chunks/props.CmCJi6lp.js";import{b as Tt,d as St,e as kt,f as Lt,g as qt,h as Nt,i as ot}from"../chunks/queryClient.DE5wO5Te.js";import{z as d,d as N}from"../chunks/drawerStore.DedmOxCn.js";import{B as Rt}from"../chunks/BasePage.C0WGob7w.js";import{I as Et}from"../chunks/IconLockPin.Cd3JSPAq.js";import{S as Pt}from"../chunks/Scrollable.o539_OHr.js";import{f as jt}from"../chunks/formatDistanceToNow.DXTjigy3.js";const Ft=(E,u,s,c,g,P,J)=>{const S={header:"Add Charge Authorization",fields:[{label:"Charger ID",name:"chargerId",type:"dropdown",options:u().data?u().data.map(e=>({label:`${e.friendlyName} (${e.vendor})`,value:e.id.toString()})):[],validation:d.string().min(1),onChange:async e=>{if(!e)return;const v=await ot.connector.charger[":id"].$get({param:{id:e}}).then(m=>m.json());N.overwriteDeep(m=>{const b=m.fields.find(h=>h.name==="connectorId");if(!(!b||b.type!=="dropdown"))return b.options=[{label:"All",value:""},...v.map(h=>({label:h.id.toString(),value:h.id.toString()}))],m})}},{label:"Connector ID",name:"connectorId",type:"dropdown",options:[],validation:d.string()},{label:"Expiry Date",name:"expiryDate",type:"date",defaultValue:"",validation:d.string()},{label:"RFID Tag ID",name:"rfidTagId",type:"dropdown",options:c().data?c().data.map(e=>({label:`${e.friendlyName} (${e.rfidTag})`,value:e.id.toString()})):[],validation:d.string().min(1)},{label:"Watt Limit",name:"wLimit",type:"number",validation:d.coerce.number().nullable()}],actions:[{label:"Create",key:"create",class:"btn-primary",buttonType:"submit",callback:({fieldValues:e,close:v})=>{P().mutate({chargerId:parseInt(e.chargerId),connectorId:parseInt(e.connectorId)||null,expiryDate:e.expiryDate?new Date(e.expiryDate):null,rfidTagId:parseInt(e.rfidTagId)||null,wLimit:e.wLimit||null}),v()}}]};N.open(S)};var Ut=(E,u,s)=>u(o(s)),Wt=R('<div class="bg-base-200 rounded-lg p-6 shadow-md"><div class="flex items-center justify-between"><div class="flex items-center gap-4"><!> <div><h3 class="text-xl font-semibold"> </h3> <p class="text-sm text-gray-500"> </p></div></div> <button class="btn btn-ghost btn-sm">Edit</button></div> <table class="bg-base-300 mt-4 table w-full overflow-hidden rounded-lg"><tbody><tr><td class="w-60 font-medium">Created</td><td> </td></tr><tr><td class="w-60 font-medium">Expiry Date</td><td> </td></tr><tr><td class="w-60 font-medium">Watt Limit</td><td> </td></tr><tr><td class="w-60 font-medium">RFID Tag</td><td> </td></tr></tbody></table></div>'),Mt=R('<div class="bg-base-200 rounded-lg p-8 text-center"><p class="text-base-content">Loading Charge Authorizations...</p></div>'),Qt=R('<div class="space-y-6"><!></div>'),Bt=R('<div class="container mx-auto px-4"><div class="mb-6 flex items-center justify-between"><h1 class="text-2xl font-bold">Charge Authorizations</h1> <button class="btn btn-primary">Add Charge Authorization</button></div> <!></div>');function ne(E,u){ft(u,!1);const s=zt(),c=()=>x(v,"$queryChargers",s),g=()=>x(m,"$queryRfidTags",s),P=()=>x(b,"$mutationChargeAuthorizationCreate",s),J=()=>x(h,"$mutationChargeAuthorizationUpdate",s),K=()=>x(dt,"$mutationChargeAuthorizationDelete",s),S=()=>x(e,"$queryChargeAuthorizations",s),e=Tt(1e4),v=St(1e4),m=kt(1e4),b=Lt(),h=qt(),dt=Nt(),st=n=>{var f,$,y,k;const j=[{label:"Charger ID",name:"chargerId",type:"dropdown",defaultValue:n.chargerId.toString(),options:c().data?c().data.map(t=>({label:`${t.friendlyName} (${t.vendor})`,value:t.id.toString()})):[],validation:d.string().min(1),onChange:async t=>{if(!t)return;const p=await ot.connector.charger[":id"].$get({param:{id:t}}).then(C=>C.json());N.overwriteDeep(C=>{const A=C.fields.find(I=>I.name==="connectorId");if(!(!A||A.type!=="dropdown"))return A.options=[{label:"All",value:""},...p.map(I=>({label:I.id.toString(),value:I.id.toString()}))],C})}},{label:"Connector ID",name:"connectorId",type:"dropdown",defaultValue:((f=n.connectorId)==null?void 0:f.toString())||"",options:[],validation:d.string()},{label:"Expiry Date",name:"expiryDate",type:"date",defaultValue:n.expiryDate||"",validation:d.string()},{label:"RFID Tag ID",name:"rfidTagId",type:"dropdown",defaultValue:(($=n.rfidTagId)==null?void 0:$.toString())||"",options:g().data?g().data.map(t=>({label:`${t.friendlyName} (${t.rfidTag})`,value:t.id.toString()})):[],validation:d.string().min(1)},{label:"Watt Limit",name:"wLimit",type:"number",defaultValue:n.wLimit||void 0,validation:d.coerce.number().nullable()}],D={header:"Edit Charge Authorization",fields:j,actions:[{label:"Save",key:"save",class:"btn-primary",buttonType:"submit",callback:({fieldValues:t,close:p})=>{J().mutate({id:n.id,chargerId:parseInt(t.chargerId),connectorId:t.connectorId?parseInt(t.connectorId):null,expiryDate:t.expiryDate?new Date(t.expiryDate):null,rfidTagId:parseInt(t.rfidTagId)||null,wLimit:t.wLimit?Number(t.wLimit):null}),p()}},{label:"Cancel",key:"cancel",class:"btn-outline",callback:({close:t})=>{t()}},{label:"Delete",key:"delete",class:"btn-error btn-outline",buttonType:"button",callback:({close:t})=>{K().mutate({id:n.id}),t()}}]};N.open(D),(k=(y=j.find(t=>t.name==="chargerId"))==null?void 0:y.onChange)==null||k.call(y,n.chargerId.toString())};At(),Rt(E,{title:"Charge Authorizations",children:(n,j)=>{var D=Bt(),f=a(D),$=i(a(f),2);$.__click=[Ft,c,v,g,m,P,b],r(f);var y=i(f,2);Pt(y,{class:"p-4",maxHeight:"80svh",children:(k,t)=>{var p=Qt(),C=a(p);{var A=_=>{var L=wt(),lt=Ct(L);Dt(lt,1,()=>S().data,$t,(ct,l)=>{var F=Wt();const O=It(()=>{var z;return(z=g().data)==null?void 0:z.find(q=>q.id===o(l).rfidTagId)});var U=a(F),W=a(U),X=a(W);Et(X,{class:"text-primary h-10 w-10"});var Y=i(X,2),M=a(Y),mt=a(M);r(M);var Z=i(M,2),pt=a(Z);r(Z),r(Y),r(W);var ut=i(W,2);ut.__click=[Ut,st,l],r(U);var V=i(U,2),tt=a(V),Q=a(tt),et=i(a(Q)),gt=a(et,!0);G(()=>w(gt,jt(new Date(o(l).createdAt),{addSuffix:!0}))),r(et),r(Q);var B=i(Q),at=i(a(B)),vt=a(at,!0);r(at),r(B);var H=i(B),rt=i(a(H)),bt=a(rt,!0);r(rt),r(H);var it=i(H),nt=i(a(it)),ht=a(nt);r(nt),r(it),r(tt),r(V),r(F),G(()=>{var z,q;w(mt,`Charger ID: ${o(l).chargerId??""}`),w(pt,`Connector ID: ${o(l).connectorId??"N/A"??""}`),w(vt,o(l).expiryDate??"N/A"),w(bt,o(l).wLimit?`${o(l).wLimit} W`:"No limit"),w(ht,`${((z=o(O))==null?void 0:z.friendlyName)??""} (${((q=o(O))==null?void 0:q.rfidTag)??""})`)}),T(ct,F)}),T(_,L)},I=_=>{var L=Mt();T(_,L)};xt(C,_=>{S().data?_(A):_(I,!1)})}r(p),T(k,p)},$$slots:{default:!0}}),r(D),G(()=>$.disabled=c().isPending||g().isPending),T(n,D)},$$slots:{default:!0}}),yt()}_t(["click"]);export{ne as component};
