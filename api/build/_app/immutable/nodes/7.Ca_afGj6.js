import"../chunks/disclose-version.Bg9kRutz.js";import"../chunks/legacy.D2MqI-vY.js";import{t as _,e as Ae,k as e,n as r,r as t,f as Re,x as De,q as n,a4 as I}from"../chunks/runtime.Bd4EnX-u.js";import{a as m,n as qe,d as Le,s as d,t as C,c as He}from"../chunks/render.qcllsTlz.js";import{i as B}from"../chunks/if.dA70V0X5.js";import{e as je,i as Fe}from"../chunks/each.CqG-kNtr.js";import{i as bt}from"../chunks/lifecycle.C1YRy3UF.js";import{b as ze,s as Te,a as k}from"../chunks/props.D1o1xWrs.js";import{B as pt}from"../chunks/BasePage.BX5KYPMs.js";import{m as _t,n as ft,o as xt,p as yt,q as Ct,d as wt,t as kt}from"../chunks/queryClient.BEUBuIH3.js";import{s as Ie,t as Ne,b as Ue}from"../chunks/class.C0QSkcSh.js";import{b as Mt}from"../chunks/this.CoGCOP9m.js";import{d as Be,z as H,t as f}from"../chunks/toast.CH_ZFDER.js";import{f as St}from"../chunks/formatDistanceToNow.Cbs4euKL.js";import{S as Pt}from"../chunks/Scrollable.BrMQmy-M.js";var Vt=qe('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M18 7l-1 1"></path><path d="M14 11h1a2 2 0 0 1 2 2v3a1.5 1.5 0 0 0 3 0v-7l-3 -3"></path><path d="M4 20v-14a2 2 0 0 1 2 -2h6a2 2 0 0 1 2 2v14"></path><path d="M9 11.5l-1.5 2.5h3l-1.5 2.5"></path><path d="M3 20l12 0"></path><path d="M4 8l10 0"></path></svg>');function Et(u,a){let i=ze(a,"class",3,"");var l=Vt();_(()=>Ie(l,`icon icon-tabler icons-tabler-outline icon-tabler-charging-pile ${(i()||"")??""}`)),m(u,l)}var Nt=qe('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M9.785 6l8.215 8.215l-2.054 2.054a5.81 5.81 0 1 1 -8.215 -8.215l2.054 -2.054z"></path><path d="M4 20l3.5 -3.5"></path><path d="M15 4l-3.5 3.5"></path><path d="M20 9l-3.5 3.5"></path></svg>');function Ut(u,a){let i=ze(a,"class",3,"");var l=Nt();_(()=>Ie(l,`icon icon-tabler icons-tabler-outline icon-tabler-plug ${(i()||"")??""}`)),m(u,l)}const At=(u,a,i,l,h,M)=>{Be.open({header:"Edit Charger",fields:[{label:"Friendly Name",name:"friendlyName",type:"text",defaultValue:a.charger.friendlyName||"",validation:H.string().min(1,{message:"Please enter a friendly name."})},{label:"Shortcode",name:"shortcode",type:"text",defaultValue:a.charger.shortcode||"",validation:H.string().regex(/^[a-z0-9-]+$/,{message:"Only lowercase letters, numbers, and dashes are allowed (no spaces or other characters)."}).min(5,{message:"Minimum length is 5 characters."}).max(30,{message:"Maximum length is 30 characters."})},{label:"Status",name:"status",type:"dropdown",options:[{label:"Pending",value:"Pending"},{label:"Accepted",value:"Accepted"},{label:"Rejected",value:"Rejected"}],defaultValue:a.charger.status||"Pending",validation:H.enum(["Pending","Accepted","Rejected"])}],actions:[{label:"Save",key:"save",class:"btn-primary",buttonType:"submit",callback:({fieldValues:c,close:S})=>{i().mutate({id:a.charger.id.toString(),friendlyName:c.friendlyName,status:c.status,shortcode:c.shortcode},{onError:()=>{f({message:"Error saving charger",type:"error"})},onSuccess:()=>{f({message:"Charger saved",type:"success"}),S()}})}},{label:"Cancel",key:"cancel",class:"btn-outline",callback:({close:c})=>{c()}},{label:"Delete",key:"delete",class:"btn-error btn-outline",buttonType:"button",callback:({close:c})=>{h().mutate({id:a.charger.id.toString()},{onError:()=>{f({message:"Error deleting charger",type:"error"})},onSuccess:()=>{f({message:"Charger deleted",type:"success"}),c()}}),c()}}]})};var Rt=(u,a)=>a("Soft"),Dt=(u,a)=>a("Hard"),qt=C('<div class="text-sm"><p><b>Current Load:</b> </p> <p><b>Power:</b> </p> <p><b>Temperature:</b> </p> <p><b>Frequency:</b> </p></div>'),Lt=C('<p class="text-sm">Telemetry data unavailable</p>'),Ht=C('<p class="text-error mt-1 text-sm"> </p>'),jt=(u,a,i,l)=>a().mutate({id:n(l).id.toString()},{onSuccess(h){f({message:h.success?"Connector unlocked":"Failed unlocking connector",type:h.success?"success":"error"})},onError(){f({message:"Failed unlocking connector",type:"error"})}}),Ft=C('<div class="bg-base-300 flex w-full items-center justify-between rounded-lg p-4 shadow-md"><div class="flex items-center gap-4"><!> <div class="flex flex-col text-left"><span class="font-bold"> </span> <!> <!></div> <div class="w-16"></div> <button class="btn btn-ghost btn-sm">Unlock</button></div> <div class="flex items-center gap-4"><p class="text-sm font-medium"> </p> <div></div></div></div>'),zt=C('<div class="bg-base-200 container mx-auto rounded-lg px-4 py-6 shadow-md"><div class="mb-6 flex items-center justify-between"><div class="flex items-center gap-4"><!> <div><h2 class="text-2xl font-semibold"> </h2> <p class="text-sm text-gray-500"> </p></div></div> <div class="flex gap-x-2"><div><button class="btn btn-ghost btn-sm">Reset</button> <dialog class="modal"><div class="modal-box"><form method="dialog"><button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">✕</button></form> <h3 class="mb-10 text-lg font-bold">Reset Charger</h3> <div class="flex gap-x-2"><button class="btn btn-warning btn-sm">Soft Reset</button> <button class="btn btn-error btn-sm">Hard Reset</button></div></div></dialog></div> <button class="btn btn-ghost btn-sm">Edit</button></div></div> <div class="mb-6"><span class="badge badge-lg badge-outline p-3"> </span></div> <table class="bg-base-300 table w-full overflow-hidden rounded-lg"><tbody><tr><td class="w-60 font-medium">Connectivity</td><td><span> </span></td></tr><tr><td class="w-60 font-medium">Firmware</td><td> </td></tr><tr><td class="w-60 font-medium">Model</td><td> </td></tr><tr><td class="w-60 font-medium">Last Heartbeat</td><td> </td></tr><tr><td class="w-60 font-medium">Shortcode</td><td> </td></tr></tbody></table> <div class="mt-6"><h3 class="mb-4 text-xl font-bold">Connectors</h3> <div class="space-y-4"><!></div></div></div>');function Tt(u,a){Ae(a,!0);const i=Te(),l=()=>k(P,"$mutationChargerUpdate",i),h=()=>k(V,"$mutationChargerDelete",i),M=()=>k($,"$mutationChargerReset",i),c=()=>k(de,"$queryConnectors",i),S=()=>k(j,"$mutationConnectorUnlock",i),de=_t(a.charger.id.toString(),1e4),P=ft(),V=xt(),$=yt(),j=Ct(),O=v=>({Available:"bg-success",Preparing:"bg-info",Charging:"bg-primary",SuspendedEVSE:"bg-warning",SuspendedEV:"bg-warning",Finishing:"bg-info",Reserved:"bg-secondary",Unavailable:"bg-base-300",Faulted:"bg-error"})[v]||"bg-base-300";let N;const E=v=>{M().mutate({id:a.charger.id,type:v},{onError:()=>{f({message:"Error resetting charger",type:"error"})},onSuccess:()=>{f({message:"Charger reset",type:"success"}),N.close()}})};function U(v,w){for(const q of v){const y=q.sampledValue.find(s=>s.phase===w&&s.measurand==="Current.Import");if(y)return`${y.value} ${y.unit??""}`.trim()}return"N/A"}function A(v,w){for(const q of v){const y=q.sampledValue.find(s=>s.measurand===w&&!s.phase);if(y)return y.value}return"N/A"}var R=zt(),b=e(R),x=e(b),F=e(x);Et(F,{class:"text-primary h-10 w-10"});var z=r(F,2),D=e(z),$e=e(D,!0);t(D);var ce=r(D,2),Oe=e(ce,!0);t(ce),t(z),t(x);var ve=r(x,2),Q=e(ve),ue=e(Q);ue.__click=()=>N.showModal();var W=r(ue,2),ge=e(W),me=r(e(ge),4),G=e(me);G.__click=[Rt,E];var he=r(G,2);he.__click=[Dt,E],t(me),t(ge),t(W),Mt(W,v=>N=v,()=>N),t(Q);var Qe=r(Q,2);Qe.__click=[At,a,l,P,h,V],t(ve),t(b);var J=r(b,2),T=e(J),We=e(T,!0);t(T),t(J);var K=r(J,2),be=e(K),X=e(be),pe=r(e(X)),Y=e(pe),Ge=e(Y,!0);t(Y),t(pe),t(X);var Z=r(X),_e=r(e(Z)),Je=e(_e,!0);t(_e),t(Z);var ee=r(Z),fe=r(e(ee)),Ke=e(fe,!0);t(fe),t(ee);var te=r(ee),xe=r(e(te)),Xe=e(xe,!0);_(()=>d(Xe,a.charger.lastHeartbeat?St(new Date(a.charger.lastHeartbeat),{addSuffix:!0}):"N/A")),t(xe),t(te);var ye=r(te),Ce=r(e(ye)),Ye=e(Ce,!0);t(Ce),t(ye),t(be),t(K);var we=r(K,2),ke=r(e(we),2),Ze=e(ke);{var et=v=>{var w=He(),q=De(w);je(q,1,()=>c().data,Fe,(y,s)=>{var ae=Ft(),re=e(ae),Me=e(re);Ut(Me,{class:"h-6 w-6 text-current"});var se=r(Me,2),ne=e(se),tt=e(ne);t(ne);var Se=r(ne,2);{var at=p=>{var g=qt(),L=e(g);const dt=I(()=>{var o;return U((o=n(s).telemetry)==null?void 0:o.meterValue.raw,"L1")??""}),ct=I(()=>{var o;return U((o=n(s).telemetry)==null?void 0:o.meterValue.raw,"L2")??""}),vt=I(()=>{var o;return U((o=n(s).telemetry)==null?void 0:o.meterValue.raw,"L3")??""});var ut=r(e(L));_(()=>d(ut,` L1: ${n(dt)}, L2: ${n(ct)}, L3: ${n(vt)}`)),t(L);var ie=r(L,2),gt=r(e(ie));_(()=>{var o;return d(gt,` ${A((o=n(s).telemetry)==null?void 0:o.meterValue.raw,"Power.Active.Import")??""}W`)}),t(ie);var le=r(ie,2),mt=r(e(le));_(()=>{var o;return d(mt,` ${A((o=n(s).telemetry)==null?void 0:o.meterValue.raw,"Temperature")??""}°C`)}),t(le);var Ee=r(le,2),ht=r(e(Ee));_(()=>{var o;return d(ht,` ${A((o=n(s).telemetry)==null?void 0:o.meterValue.raw,"Frequency")??""} Hz`)}),t(Ee),t(g),m(p,g)},rt=p=>{var g=Lt();m(p,g)};B(Se,p=>{var g;(g=n(s).telemetry)!=null&&g.meterValue.raw?p(at):p(rt,!1)})}var st=r(Se,2);{var nt=p=>{var g=Ht(),L=e(g);t(g),_(()=>d(L,`Error: ${n(s).errorCode??""}`)),m(p,g)};B(st,p=>{n(s).errorCode&&p(nt)})}t(se);var Pe=r(se,4);Pe.__click=[jt,S,j,s],t(re);var Ve=r(re,2),oe=e(Ve),ot=e(oe,!0);t(oe);var it=r(oe,2);const lt=I(()=>`h-3 w-20 rounded-full ${O(n(s).status)}`);t(Ve),t(ae),_(()=>{d(tt,`Connector ${n(s).connectorId??""}`),Pe.disabled=S().isPending,d(ot,n(s).status),Ue(it,n(lt))}),m(y,ae)}),m(v,w)};B(Ze,v=>{c().data&&v(et)})}t(ke),t(we),t(R),_(()=>{d($e,a.charger.friendlyName||"Unknown"),d(Oe,a.charger.vendor||"Unknown Vendor"),G.disabled=M().isPending,he.disabled=M().isPending,Ne(T,"badge-warning",a.charger.status==="Pending"),Ne(T,"badge-success",a.charger.status==="Accepted"),d(We,a.charger.status||"Unknown"),Ue(Y,`badge badge-outline ${a.charger.connectivity==="Online"?"badge-success":"badge-warning"} p-3 text-white`),d(Ge,a.charger.connectivity||"Unknown"),d(Je,a.charger.firmwareVersion||"N/A"),d(Ke,a.charger.model||"N/A"),d(Ye,a.charger.shortcode||"N/A")}),m(u,R),Re()}Le(["click"]);const It=(u,a,i)=>{Be.open({header:"Add Charger",fields:[{label:"Label",name:"label",type:"text",defaultValue:"",validation:H.string().min(1)},{label:"Shortcode",name:"shortcode",type:"text",defaultValue:"your-shortcode",validation:H.string().regex(/^[a-z0-9-]+$/,{message:"Only lowercase letters, numbers, and dashes are allowed (no spaces or other characters)."}).min(5,{message:"Minimum length is 5 characters."}).max(30,{message:"Maximum length is 30 characters."})}],actions:[{label:"Create",key:"create",class:"btn-primary",buttonType:"submit",callback:({fieldValues:l,close:h})=>{a().mutate({friendlyName:l.label,shortcode:l.shortcode},{onError:()=>{f({message:"Error creating charger",type:"error"})},onSuccess:()=>{f({message:"Charger created",type:"success"}),h()}})}}]})};var Bt=C('<div class="bg-base-200 rounded-lg p-8 text-center"><p class="text-base-content">Loading chargers...</p></div>'),$t=C('<div class="space-y-6"><!></div>'),Ot=C('<div class="container mx-auto px-4"><div class="mb-6 flex items-center justify-between"><h1 class="text-2xl font-bold">Chargers</h1> <button class="btn btn-primary">Add Charger</button></div> <!></div>');function ia(u,a){Ae(a,!1);const i=Te(),l=()=>k(c,"$mutationChargerCreate",i),h=()=>k(M,"$queryChargers",i),M=wt(1e4),c=kt();bt(),pt(u,{title:"Monitoring",children:(S,de)=>{var P=Ot(),V=e(P),$=r(e(V),2);$.__click=[It,l,c],t(V);var j=r(V,2);Pt(j,{class:"p-4",maxHeight:"80svh",children:(O,N)=>{var E=$t(),U=e(E);{var A=b=>{var x=He(),F=De(x);je(F,1,()=>h().data,Fe,(z,D)=>{Tt(z,{get charger(){return n(D)}})}),m(b,x)},R=b=>{var x=Bt();m(b,x)};B(U,b=>{h().data?b(A):b(R,!1)})}t(E),m(O,E)},$$slots:{default:!0}}),t(P),m(S,P)},$$slots:{default:!0}}),Re()}Le(["click"]);export{ia as component};
